---
import Layout from '../layouts/Layout.astro';
---

<Layout title="System Intelligence Benchmark - Contributor">
  <div class="block">
    <div class="block-header">Overview</div>
    <p style="color: var(--muted); font-size: 0.875rem; margin-bottom: 1rem;">
      Add course exams and labs to the System Intelligence Benchmark repository.
    </p>
    <div class="row">
      <a href="/exams" style="text-decoration: none;">
        <div class="block" style="cursor: pointer; transition: border-color 0.15s;">
          <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">Exams</div>
          <p style="color: var(--muted); font-size: 0.75rem;">
            Upload PDF/TXT exam files and solutions. Generate structured exam.md format.
          </p>
        </div>
      </a>
      <a href="/labs" style="text-decoration: none;">
        <div class="block" style="cursor: pointer; transition: border-color 0.15s;">
          <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">Labs</div>
          <p style="color: var(--muted); font-size: 0.75rem;">
            Submit GitHub repo URL. AI agent analyzes and creates courselab format.
          </p>
        </div>
      </a>
    </div>
  </div>

  <div class="block">
    <div class="block-header">Configuration</div>
    <p style="color: var(--muted); font-size: 0.75rem; margin-bottom: 1rem;">
      Configure paths and API key for your local environment.
    </p>

    <label for="repo-path">Benchmark Repository Path</label>
    <input type="text" id="repo-path" placeholder="/path/to/system-intelligence-benchmark" />
    <p style="color: var(--muted); font-size: 0.625rem; margin-top: 0.25rem; margin-bottom: 1rem;">
      Local path to the cloned system-intelligence-benchmark repository
    </p>

    <label for="api-key">OpenAI API Key</label>
    <input type="text" id="api-key" placeholder="sk-..." />

    <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border);">
      <div style="font-size: 0.875rem; font-weight: 500; margin-bottom: 0.25rem;">GitHub Integration (Optional)</div>
      <p style="color: var(--muted); font-size: 0.625rem; margin-bottom: 1rem;">
        Auto-create branches and push commits
      </p>

      <label for="github-username">GitHub Username</label>
      <input type="text" id="github-username" placeholder="your-username" />

      <label for="github-token">GitHub Personal Access Token</label>
      <input type="text" id="github-token" placeholder="ghp_..." />
      <p style="color: var(--muted); font-size: 0.625rem; margin-top: 0.25rem; margin-bottom: 1rem;">
        Token needs repo write permissions. Creates branches and pushes commits automatically.
      </p>
    </div>

    <button id="save-config">Save Configuration</button>
    <div id="config-status" class="status" style="display: none;"></div>
  </div>

  <script>
    const repoPathInput = document.getElementById('repo-path') as HTMLInputElement;
    const keyInput = document.getElementById('api-key') as HTMLInputElement;
    const githubUsernameInput = document.getElementById('github-username') as HTMLInputElement;
    const githubTokenInput = document.getElementById('github-token') as HTMLInputElement;
    const saveBtn = document.getElementById('save-config');
    const configStatus = document.getElementById('config-status');

    // Load saved config
    const savedRepoPath = sessionStorage.getItem('benchmark_repo_path');
    const savedKey = sessionStorage.getItem('openai_api_key');
    const savedGithubUsername = sessionStorage.getItem('github_username');
    const savedGithubToken = sessionStorage.getItem('github_token');

    if (savedRepoPath) {
      repoPathInput.value = savedRepoPath;
    }
    if (savedKey) {
      keyInput.value = savedKey;
    }
    if (savedGithubUsername) {
      githubUsernameInput.value = savedGithubUsername;
    }
    if (savedGithubToken) {
      githubTokenInput.value = savedGithubToken;
    }

    saveBtn?.addEventListener('click', () => {
      const repoPath = repoPathInput.value.trim();
      const key = keyInput.value.trim();
      const githubUsername = githubUsernameInput.value.trim();
      const githubToken = githubTokenInput.value.trim();

      if (repoPath) {
        sessionStorage.setItem('benchmark_repo_path', repoPath);
      }
      if (key) {
        sessionStorage.setItem('openai_api_key', key);
      }
      if (githubUsername) {
        sessionStorage.setItem('github_username', githubUsername);
      }
      if (githubToken) {
        sessionStorage.setItem('github_token', githubToken);
      }

      if (configStatus && (repoPath || key || githubUsername || githubToken)) {
        configStatus.style.display = 'block';
        configStatus.className = 'status success';
        configStatus.textContent = 'Configuration saved to session storage';
      }
    });
  </script>
</Layout>
